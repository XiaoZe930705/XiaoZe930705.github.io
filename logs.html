<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>前端紀錄</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Microsoft JhengHei", sans-serif; background:#f6f6f6; color:#333; }
    .container { max-width: 960px; margin: 32px auto; background:#fff; border-radius:12px; box-shadow:0 6px 20px rgba(0,0,0,0.12); padding:20px; }
    h1 { font-size:20px; margin-bottom:12px; color:#007344; }
    .actions { display:flex; gap:8px; margin-bottom:12px; }
    button { padding:8px 12px; border-radius:8px; border:1px solid #ccc; background:#fafafa; cursor:pointer; }
    table { width:100%; border-collapse: collapse; }
    th, td { border-bottom:1px solid #eee; padding:10px; font-size:14px; text-align:left; }
    th { background:#f9f9f9; }
    .empty { color:#777; font-size:14px; margin: 12px 0; }
    .footer { margin-top:16px; font-size:12px; color:#777; }
  </style>
</head>
<body>
  <div class="container">
    <h1>前端紀錄（不送後端）</h1>
    <div class="actions">
      <button id="btn-refresh">重新載入</button>
      <button id="btn-clear">清除全部紀錄</button>
      <button onclick="window.location.href='index.html'">回到首頁</button>
    </div>

    <div id="table-wrap"></div>

    <div class="footer">資料將於課程結束後清除。</div>
  </div>

  <script>
    const KEY = 'fish_logs';

    function render() {
      const wrap = document.getElementById('table-wrap');
      const rows = JSON.parse(localStorage.getItem(KEY) || '[]');
      if (!rows.length) {
        wrap.innerHTML = '<div class="empty">目前沒有紀錄。</div>';
        return;
      }
      const header = '<thead><tr><th>帳號</th><th>IP</th><th>語言</th><th>時間</th></tr></thead>';
      const body = '<tbody>' + rows.map(r => {
        const acc = escapeHtml(r.account || '');
        const ip = escapeHtml(r.ip || '');
        const lang = escapeHtml(r.lang || '');
        const time = escapeHtml(r.time || '');
        return `<tr><td>${acc}</td><td>${ip}</td><td>${lang}</td><td>${time}</td></tr>`;
      }).join('') + '</tbody>';
      wrap.innerHTML = `<table>${header}${body}</table>`;
    }

    function escapeHtml(str) {
      return String(str)
        .replaceAll('&', '&amp;')
        .replaceAll('<', '&lt;')
        .replaceAll('>', '&gt;')
        .replaceAll('"', '&quot;')
        .replaceAll("'", '&#39;');
    }

    document.getElementById('btn-refresh').addEventListener('click', render);
    document.getElementById('btn-clear').addEventListener('click', () => {
      const pwd = prompt('請輸入密碼以清除所有紀錄：');
      if (pwd === null) return;
      if (pwd !== 'MLAB') {
        alert('密碼錯誤。');
        return;
      }
      localStorage.removeItem(KEY);
      render();
      alert('紀錄已清除。');
    });

    render();
  </script>
</body>
</html>
